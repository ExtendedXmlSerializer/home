environment:
  BUILD_SOLUTION_PATH: '.\ExtendedXmlSerializer.sln'
  BUILD_DOCUMENTATION_PATH: '.\documentation\docfx.json'
  API_GITHUB_TOKEN:
    secure: gw4s8lJBH6erxHXzmAXO3GiXQyTr+sU2y2ADADUP07FeUHyTSWypnnjjJVg02H7EYrkaLMGoIeo6UAWgftm62+BDmdCUPxG9H4tx/2fAbfjc+q6pF+X5qtz6FONRcgJk
  API_APPVEYOR_TOKEN:
    secure: xQR4THytwto+UTuQtpj5N5RcD4pDHIJVnahrbQ7Xqjs=
  DEPLOY_KEY:
    secure: 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
  DEPLOY_USER: ExtendedXmlSerializer Automation via AppVeyor
  DEPLOY_EMAIL: ExtendedXmlSerializer@users.noreply.github.com

image: Visual Studio 2022

skip_tags: true
skip_non_tags: true
skip_commits:
  author: /Automation Agent/

only_commits:
  files:
    - '*.sln'
    - '.build\**\*'
    - src\**\*
    - test\**\*
    - documentation\**\*

configuration: Debug

dotnet_csproj:
  patch: true
  file: src\*\*.csproj
  version_prefix: '{version}'

nuget:
  project_feed: false
  disable_publish_on_pr: true

pull_requests:
  do_not_increment_build_number: true

for:
- # Development
  skip_non_tags: false
  branches:
    only:
      - master

  install:
    - ps: . .\.build\Install.ps1

  build_script:
  - ps: |
        Exec { & dotnet build $env:BUILD_SOLUTION_PATH -c Release }
        Exec { & dotnet pack $env:BUILD_SOLUTION_PATH -c Release }

  notifications:
    - provider: GitHubPullRequest
      template: |
        {{#passed}}:white_check_mark:{{/passed}}{{#failed}}:x:{{/failed}} [Build {{&projectName}} {{buildVersion}} {{status}}]({{buildUrl}}) (commit {{commitUrl}} by @{{&commitAuthorUsername}})

        {{#passed}}
        Install it by running the following command in [Package Manager Console](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-powershell):

        ```
        Install-Package ExtendedXmlSerializer -Version {{buildVersion}} -Source https://ci.appveyor.com/nuget/extendedxmlserializer-preview
        ```

        Problems with the above command? You may be running into this known issue here:
        https://github.com/NuGet/Home/issues/7189
        {{/passed}}
      on_build_success: true

  after_test:
    - ps: Exec { & dotnet test $env:BUILD_SOLUTION_PATH -c Release -f netcoreapp3.1 }

  nuget:
    project_feed: true
    disable_publish_on_pr: false

  artifacts:
    - path: src\**\*.nupkg
      name: 'Preview Package $(APPVEYOR_BUILD_VERSION)'

- # Debug
  skip_non_tags: false
  branches:
    only:
      - /debug\/\w*/

  cache:
    - '%USERPROFILE%\.ssh\known_hosts'

  install:
    - ps: . .\.build\Install.ps1
    - ps: .\.build\Prepare-Deployment.ps1

  build_script:
    - ps: Exec { & dotnet pack $env:BUILD_SOLUTION_PATH -c Release }
    - ps: Exec { & docfx $env:BUILD_DOCUMENTATION_PATH }

  test: off

  on_success:
    - ps: .\.build\Deploy-Documentation.ps1


- # Deploy
  branches:
    only:
      - /\d*\.\d*\.\d*/

  init:
    - ps: |
          if (!$env:APPVEYOR_FORCED_BUILD)
          {
            throw "This configuration should only be called from external workflows."
          }

  cache:
    - '%USERPROFILE%\.ssh\known_hosts'

  install:
    - ps: . .\.build\Install.ps1
    - ps: .\.build\Prepare-Deployment.ps1

  build_script:
    - ps: Exec { & dotnet pack $env:BUILD_SOLUTION_PATH -c Release }
    - ps: Exec { & docfx $env:BUILD_DOCUMENTATION_PATH }

  test: off

  before_deploy:
    - ps: .\.build\Store-CurrentRelease.ps1

  artifacts:
    - path: src\**\*.nupkg
      name: '$(APPVEYOR_PROJECT_NAME) $(APPVEYOR_BUILD_VERSION)'

  deploy:
    - provider: GitHub
      tag: $(APPVEYOR_REPO_TAG_NAME)
      release: $(DEPLOY_RELEASE_NAME)
      description: $(DEPLOY_RELEASE_DESCRIPTION)
      artifact: /.*\.nupkg/
      draft: false
      prerelease: $(DEPLOY_RELEASE_IS_PRERELEASE)
      auth_token: $(API_GITHUB_TOKEN)
      force_update: true
    - provider: NuGet
      name: production
      api_key:
        secure: JB8ibMm+7Qvfc2Kd1jhFs2Yh6Q0AvsxneG9W5EvCP2enVbhZDU3pjCjMp+AUBgrU
  on_success:
    - ps: .\.build\Deploy-Documentation.ps1
