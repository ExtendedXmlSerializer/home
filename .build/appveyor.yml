environment:
  BUILD_SOLUTION_PATH: '.\ExtendedXmlSerializer.sln'
  BUILD_DOCUMENTATION_PATH: '.\documentation\docfx.json'
  API_GITHUB_TOKEN:
    secure: rfWPhYeHHl/ToVinvh16suzR4halfT0kJ8RKEVX4udo7f4t9m4TDmyIqqeqVLJJN
  API_APPVEYOR_TOKEN:
    secure: xQR4THytwto+UTuQtpj5N5RcD4pDHIJVnahrbQ7Xqjs=
  DEPLOY_KEY:
    secure: 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
  DEPLOY_USER: ExtendedXmlSerializer Automation via AppVeyor
  DEPLOY_EMAIL: ExtendedXmlSerializer@users.noreply.github.com

image: Visual Studio 2022

skip_tags: true
skip_non_tags: true
skip_commits:
  author: /Automation Agent/

only_commits:
  files:
    - '*.sln'
    - '.build\**\*'
    - src\**\*
    - test\**\*
    - documentation\**\*

configuration: Debug

dotnet_csproj:
  patch: true
  file: src\*\*.csproj
  version_prefix: '{version}'

nuget:
  project_feed: false
  disable_publish_on_pr: true

pull_requests:
  do_not_increment_build_number: true

for:
- # Development
  skip_non_tags: false
  branches:
    only:
      - master

  install:
    - ps: . .\.build\Install.ps1

  build_script:
  - ps: |
        Exec { & dotnet build $env:BUILD_SOLUTION_PATH -c Release }
        Exec { & dotnet pack $env:BUILD_SOLUTION_PATH -c Release }

  notifications:
    - provider: GitHubPullRequest
      template: |
        {{#passed}}:white_check_mark:{{/passed}}{{#failed}}:x:{{/failed}} [Build {{&projectName}} {{buildVersion}} {{status}}]({{buildUrl}}) (commit {{commitUrl}} by @{{&commitAuthorUsername}})

        {{#passed}}
        Install it by running the following command in [Package Manager Console](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-powershell):

        ```
        Install-Package ExtendedXmlSerializer -Version {{buildVersion}} -Source https://ci.appveyor.com/nuget/extendedxmlserializer-preview
        ```

        Problems with the above command? You may be running into this known issue here:
        https://github.com/NuGet/Home/issues/7189
        {{/passed}}
      on_build_success: true

  after_test:
    - ps: Exec { & dotnet test $env:BUILD_SOLUTION_PATH -c Release -f netcoreapp3.1 }

  nuget:
    project_feed: true
    disable_publish_on_pr: false

  artifacts:
    - path: src\**\*.nupkg
      name: 'Preview Package $(APPVEYOR_BUILD_VERSION)'

- # Debug
  skip_non_tags: false
  branches:
    only:
      - /debug\/\w*/

  cache:
    - '%USERPROFILE%\.ssh\known_hosts'

  install:
    - ps: . .\.build\Install.ps1
    - ps: .\.build\Prepare-Deployment.ps1

  build_script:
    - ps: Exec { & dotnet pack $env:BUILD_SOLUTION_PATH -c Release }
    - ps: Exec { & docfx $env:BUILD_DOCUMENTATION_PATH }

  test: off

  on_success:
    - ps: .\.build\Deploy-Documentation.ps1


- # Deploy
  branches:
    only:
      - /\d*\.\d*\.\d*/

  init:
    - ps: |
          if (!$env:APPVEYOR_FORCED_BUILD)
          {
            throw "This configuration should only be called from external workflows."
          }

  cache:
    - '%USERPROFILE%\.ssh\known_hosts'

  install:
    - ps: . .\.build\Install.ps1
    - ps: .\.build\Prepare-Deployment.ps1

  build_script:
    - ps: Exec { & dotnet pack $env:BUILD_SOLUTION_PATH -c Release }
    - ps: Exec { & docfx $env:BUILD_DOCUMENTATION_PATH }

  test: off

  before_deploy:
    - ps: .\.build\Store-CurrentRelease.ps1

  artifacts:
    - path: src\**\*.nupkg
      name: '$(APPVEYOR_PROJECT_NAME) $(APPVEYOR_BUILD_VERSION)'

  deploy:
    - provider: GitHub
      tag: $(APPVEYOR_REPO_TAG_NAME)
      release: $(DEPLOY_RELEASE_NAME)
      description: $(DEPLOY_RELEASE_DESCRIPTION)
      artifact: /.*\.nupkg/
      draft: false
      prerelease: $(DEPLOY_RELEASE_IS_PRERELEASE)
      auth_token: $(API_GITHUB_TOKEN)
      force_update: true
    - provider: NuGet
      name: production
      api_key:
        secure: clbJcFvVha1lBNJaYsZZrGhKMmKVWiFDko7SN7io5FOwKKp/13vjmy7VuqG65W6u
  on_success:
    - ps: .\.build\Deploy-Documentation.ps1
