environment:
  BUILD_SOLUTION_PATH: '.\ExtendedXmlSerializer.sln'
  BUILD_DOCUMENTATION_PATH: '.\documentation\docfx.json'
  API_GITHUB_TOKEN:
    secure: gw4s8lJBH6erxHXzmAXO3GiXQyTr+sU2y2ADADUP07FeUHyTSWypnnjjJVg02H7EYrkaLMGoIeo6UAWgftm62+BDmdCUPxG9H4tx/2fAbfjc+q6pF+X5qtz6FONRcgJk
  API_APPVEYOR_TOKEN:
    secure: xQR4THytwto+UTuQtpj5N5RcD4pDHIJVnahrbQ7Xqjs=
  DEPLOY_KEY:
    secure: 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
  DEPLOY_USER: ExtendedXmlSerializer Automation via AppVeyor
  DEPLOY_EMAIL: ExtendedXmlSerializer@users.noreply.github.com

image: Visual Studio 2022

skip_tags: true
skip_non_tags: true
skip_commits:
  author: /Automation Agent/

only_commits:
  files:
    - '*.sln'
    - '.build\**\*'
    - src\**\*
    - test\**\*
    - documentation\**\*

configuration: Debug

dotnet_csproj:
  patch: true
  file: src\*\*.csproj
  version_prefix: '{version}'

nuget:
  project_feed: false
  disable_publish_on_pr: true

pull_requests:
  do_not_increment_build_number: true

for:
- # Development
  skip_non_tags: false
  branches:
    only:
      - master

  install:
    - ps: . .\.build\Install.ps1

  build_script:
  - ps: |
        Exec { & dotnet build $env:BUILD_SOLUTION_PATH -c Release }
        Exec { & dotnet pack $env:BUILD_SOLUTION_PATH -c Release }

  notifications:
    - provider: GitHubPullRequest
      template: |
        {{#passed}}:white_check_mark:{{/passed}}{{#failed}}:x:{{/failed}} [Build {{&projectName}} {{buildVersion}} {{status}}]({{buildUrl}}) (commit {{commitUrl}} by @{{&commitAuthorUsername}})

        {{#passed}}
        Install it by running the following command in [Package Manager Console](https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-powershell):

        ```
        Install-Package ExtendedXmlSerializer -Version {{buildVersion}} -Source https://ci.appveyor.com/nuget/extendedxmlserializer-preview
        ```

        Problems with the above command? You may be running into this known issue here:
        https://github.com/NuGet/Home/issues/7189
        {{/passed}}
      on_build_success: true

  after_test:
    - ps: Exec { & dotnet test $env:BUILD_SOLUTION_PATH -c Release -f netcoreapp3.1 }

  nuget:
    project_feed: true
    disable_publish_on_pr: false

  artifacts:
    - path: src\**\*.nupkg
      name: 'Preview Package $(APPVEYOR_BUILD_VERSION)'

- # Debug
  skip_non_tags: false
  branches:
    only:
      - /debug\/\w*/

  cache:
    - '%USERPROFILE%\.ssh\known_hosts'

  install:
    - ps: . .\.build\Install.ps1
    - ps: .\.build\Prepare-Deployment.ps1

  build_script:
    - ps: Exec { & dotnet pack $env:BUILD_SOLUTION_PATH -c Release }
    - ps: Exec { & docfx $env:BUILD_DOCUMENTATION_PATH }

  test: off

  on_success:
    - ps: .\.build\Deploy-Documentation.ps1


- # Deploy
  branches:
    only:
      - /\d*\.\d*\.\d*/

  init:
    - ps: |
          if (!$env:APPVEYOR_FORCED_BUILD)
          {
            throw "This configuration should only be called from external workflows."
          }

  cache:
    - '%USERPROFILE%\.ssh\known_hosts'

  install:
    - ps: . .\.build\Install.ps1
    - ps: .\.build\Prepare-Deployment.ps1

  build_script:
    - ps: Exec { & dotnet pack $env:BUILD_SOLUTION_PATH -c Release }
    - ps: Exec { & docfx $env:BUILD_DOCUMENTATION_PATH }

  test: off

  before_deploy:
    - ps: .\.build\Store-CurrentRelease.ps1

  artifacts:
    - path: src\**\*.nupkg
      name: '$(APPVEYOR_PROJECT_NAME) $(APPVEYOR_BUILD_VERSION)'

  deploy:
    - provider: GitHub
      tag: $(APPVEYOR_REPO_TAG_NAME)
      release: $(DEPLOY_RELEASE_NAME)
      description: $(DEPLOY_RELEASE_DESCRIPTION)
      artifact: /.*\.nupkg/
      draft: false
      prerelease: $(DEPLOY_RELEASE_IS_PRERELEASE)
      auth_token: $(API_GITHUB_TOKEN)
      force_update: true
    - provider: NuGet
      name: production
      api_key:
        secure: JB8ibMm+7Qvfc2Kd1jhFs2Yh6Q0AvsxneG9W5EvCP2enVbhZDU3pjCjMp+AUBgrU
  on_success:
    - ps: .\.build\Deploy-Documentation.ps1
